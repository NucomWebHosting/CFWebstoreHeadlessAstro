name: Deploy to VPS                                                                                                                                
                                                                                                                                                   
on:                                                                                                                                                
  push:                                                                                                                                            
    branches: [main]                                                                                                                               
                                                                                                                                                   
jobs:                                                                                                                                              
  deploy:                                                                                                                                          
    runs-on: ubuntu-latest                                                                                                                         
    steps:                                                                                                                                         
      - uses: actions/checkout@v4                                                                                                                  
                                                                                                                                                   
      - name: Deploy via SSH                                                                                                                       
        uses: appleboy/ssh-action@v1.0.3                                                                                                           
        with:                                                                                                                                      
          host: ${{ secrets.SSH_HOST }}                                                                                                            
          username: ${{ secrets.SSH_USER }}                                                                                                        
          key: ${{ secrets.SSH_PRIVATE_KEY }}                                                                                                      
          script: |                                                                                                                                
            cd /var/www/frontend.nucomwebhosting.com                                                                                               
            git pull origin main                                                                                                                   
            npm ci                                                                                                                                 
            npm run build                                                                                                                          
            pm2 restart astro-app || pm2 start dist/server/entry.mjs --name astro-app
